table:
  name: course_certificate
  schema: public
configuration:
  column_config:
    certification_date:
      custom_name: certificationDate
    course_id:
      custom_name: courseId
    course_level:
      custom_name: courseLevel
    course_name:
      custom_name: courseName
    created_at:
      custom_name: createdAt
    expiry_date:
      custom_name: expiryDate
    is_revoked:
      custom_name: isRevoked
    legacy_course_code:
      custom_name: legacyCourseCode
    profile_id:
      custom_name: profileId
    updated_at:
      custom_name: updatedAt
  custom_column_names:
    certification_date: certificationDate
    course_id: courseId
    course_level: courseLevel
    course_name: courseName
    created_at: createdAt
    expiry_date: expiryDate
    is_revoked: isRevoked
    legacy_course_code: legacyCourseCode
    profile_id: profileId
    updated_at: updatedAt
  custom_root_fields: {}
object_relationships:
  - name: course
    using:
      foreign_key_constraint_on: course_id
  - name: participant
    using:
      manual_configuration:
        column_mapping:
          id: certificate_id
        insertion_order: null
        remote_table:
          name: course_participant
          schema: public
  - name: profile
    using:
      manual_configuration:
        column_mapping:
          profile_id: id
        insertion_order: null
        remote_table:
          name: profile
          schema: public
computed_fields:
  - name: grade
    definition:
      function:
        name: course_certificate_grade
        schema: public
  - name: status
    definition:
      function:
        name: course_certificate_status
        schema: public
insert_permissions:
  - role: trainer
    permission:
      check:
        course:
          trainers:
            profile_id:
              _eq: X-Hasura-User-Id
      columns:
        - certification_date
        - course_id
        - course_level
        - course_name
        - expiry_date
        - number
        - profile_id
select_permissions:
  - role: booking-contact
    permission:
      columns:
        - certification_date
        - course_id
        - course_level
        - course_name
        - created_at
        - expiry_date
        - id
        - is_revoked
        - legacy_course_code
        - number
        - profile_id
        - updated_at
      computed_fields:
        - grade
        - status
      filter:
        _and:
          - _or:
              - profile_id:
                  _eq: X-Hasura-User-Id
              - profile:
                  organizations:
                    organization:
                      members:
                        _and:
                          - profile_id:
                              _eq: X-Hasura-User-Id
                          - is_admin:
                              _eq: true
              - profile:
                  courses:
                    course:
                      booking_contact_profile_id:
                        _eq: X-Hasura-User-Id
          - is_revoked:
              _eq: false
      allow_aggregations: true
  - role: finance
    permission:
      columns:
        - certification_date
        - course_id
        - course_level
        - course_name
        - created_at
        - expiry_date
        - id
        - is_revoked
        - legacy_course_code
        - number
        - profile_id
        - updated_at
      computed_fields:
        - grade
        - status
      filter: {}
      allow_aggregations: true
  - role: organization-key-contact
    permission:
      columns:
        - certification_date
        - course_id
        - course_level
        - course_name
        - created_at
        - expiry_date
        - id
        - is_revoked
        - legacy_course_code
        - number
        - profile_id
        - updated_at
      computed_fields:
        - grade
        - status
      filter:
        _and:
          - _or:
              - profile_id:
                  _eq: X-Hasura-User-Id
              - profile:
                  organizations:
                    organization:
                      members:
                        _and:
                          - profile_id:
                              _eq: X-Hasura-User-Id
                          - is_admin:
                              _eq: true
              - profile:
                  courses:
                    course:
                      organization_key_contact_profile_id:
                        _eq: X-Hasura-User-Id
          - is_revoked:
              _eq: false
      allow_aggregations: true
  - role: sales-admin
    permission:
      columns:
        - certification_date
        - course_id
        - course_level
        - course_name
        - created_at
        - expiry_date
        - id
        - is_revoked
        - legacy_course_code
        - number
        - profile_id
        - updated_at
      computed_fields:
        - grade
        - status
      filter: {}
      allow_aggregations: true
  - role: sales-representative
    permission:
      columns:
        - certification_date
        - course_id
        - course_level
        - course_name
        - created_at
        - expiry_date
        - id
        - is_revoked
        - legacy_course_code
        - number
        - profile_id
        - updated_at
      computed_fields:
        - grade
        - status
      filter: {}
      allow_aggregations: true
  - role: trainer
    permission:
      columns:
        - certification_date
        - course_id
        - course_level
        - course_name
        - created_at
        - expiry_date
        - id
        - is_revoked
        - legacy_course_code
        - number
        - profile_id
        - updated_at
      computed_fields:
        - grade
        - status
      filter:
        _and:
          - _or:
              - profile_id:
                  _eq: X-Hasura-User-Id
              - course:
                  trainers:
                    profile_id:
                      _eq: X-Hasura-User-Id
              - profile:
                  organizations:
                    organization:
                      members:
                        _and:
                          - profile_id:
                              _eq: X-Hasura-User-Id
                          - is_admin:
                              _eq: true
          - is_revoked:
              _eq: false
      allow_aggregations: true
  - role: tt-admin
    permission:
      columns:
        - certification_date
        - course_id
        - course_level
        - course_name
        - created_at
        - expiry_date
        - id
        - is_revoked
        - legacy_course_code
        - number
        - profile_id
        - updated_at
      computed_fields:
        - grade
        - status
      filter: {}
      allow_aggregations: true
  - role: tt-ops
    permission:
      columns:
        - certification_date
        - course_id
        - course_level
        - course_name
        - created_at
        - expiry_date
        - id
        - is_revoked
        - legacy_course_code
        - number
        - profile_id
        - updated_at
      computed_fields:
        - grade
        - status
      filter: {}
      allow_aggregations: true
  - role: unverified
    permission:
      columns:
        - certification_date
        - course_id
        - course_level
        - course_name
        - created_at
        - expiry_date
        - id
        - is_revoked
        - legacy_course_code
        - number
        - profile_id
        - updated_at
      computed_fields:
        - grade
        - status
      filter:
        _and:
          - profile_id:
              _eq: X-Hasura-User-Id
          - is_revoked:
              _eq: false
  - role: user
    permission:
      columns:
        - certification_date
        - course_id
        - course_level
        - course_name
        - created_at
        - expiry_date
        - id
        - is_revoked
        - legacy_course_code
        - number
        - profile_id
        - updated_at
      computed_fields:
        - grade
        - status
      filter:
        _and:
          - _or:
              - profile_id:
                  _eq: X-Hasura-User-Id
              - profile:
                  organizations:
                    organization:
                      members:
                        _and:
                          - profile_id:
                              _eq: X-Hasura-User-Id
                          - is_admin:
                              _eq: true
          - is_revoked:
              _eq: false
      allow_aggregations: true
update_permissions:
  - role: sales-admin
    permission:
      columns:
        - expiry_date
      filter: {}
      check: null
  - role: tt-admin
    permission:
      columns:
        - expiry_date
        - is_revoked
      filter: {}
      check: null
  - role: tt-ops
    permission:
      columns:
        - expiry_date
        - is_revoked
      filter: {}
      check: null
delete_permissions:
  - role: tt-ops
    permission:
      filter: {}
event_triggers:
  - name: certificate_revoke
    definition:
      enable_manual: false
      update:
        columns:
          - is_revoked
    retry_conf:
      interval_sec: 10
      num_retries: 0
      timeout_sec: 60
    webhook: '{{EVENTS_HOST}}/certificate/revoke'
  - name: course_certificate_added
    definition:
      enable_manual: false
      insert:
        columns: '*'
    retry_conf:
      interval_sec: 10
      num_retries: 0
      timeout_sec: 60
    webhook: '{{EVENTS_HOST}}/participant/role'
  - name: course_certificate_expiry_date_changed
    definition:
      enable_manual: false
      insert:
        columns: '*'
      update:
        columns:
          - is_revoked
          - expiry_date
    retry_conf:
      interval_sec: 10
      num_retries: 0
      timeout_sec: 60
    webhook: '{{EVENTS_HOST}}/certificate/expiry-date-changed'
