table:
  schema: public
  name: promo_code
configuration:
  custom_root_fields: {}
  column_config:
    valid_from:
      custom_name: validFrom
    uses_max:
      custom_name: usesMax
    created_by:
      custom_name: createdBy
    approved_by:
      custom_name: approvedBy
    updated_at:
      custom_name: updatedAt
    booker_single_use:
      custom_name: bookerSingleUse
    valid_to:
      custom_name: validTo
    created_at:
      custom_name: createdAt
    denied_by:
      custom_name: deniedBy
  custom_column_names:
    valid_from: validFrom
    uses_max: usesMax
    created_by: createdBy
    approved_by: approvedBy
    updated_at: updatedAt
    booker_single_use: bookerSingleUse
    valid_to: validTo
    created_at: createdAt
    denied_by: deniedBy
object_relationships:
  - name: approver
    using:
      foreign_key_constraint_on: approved_by
  - name: creator
    using:
      foreign_key_constraint_on: created_by
array_relationships:
  - name: courses
    using:
      foreign_key_constraint_on:
        column: promo_id
        table:
          schema: public
          name: course_promo_code
insert_permissions:
  - role: finance
    permission:
      check: {}
      columns:
        - amount
        - booker_single_use
        - code
        - created_by
        - description
        - enabled
        - id
        - levels
        - type
        - uses_max
        - valid_from
        - valid_to
      backend_only: false
  - role: ld
    permission:
      check: {}
      columns: []
      backend_only: false
  - role: sales-admin
    permission:
      check:
        _or:
          - approved_by:
              _eq: X-Hasura-User-Id
          - approved_by:
              _is_null: true
      columns:
        - amount
        - approved_by
        - booker_single_use
        - code
        - created_by
        - description
        - enabled
        - id
        - levels
        - type
        - uses_max
        - valid_from
        - valid_to
      backend_only: false
  - role: tt-ops
    permission:
      check:
        _or:
          - approved_by:
              _eq: X-Hasura-User-Id
          - approved_by:
              _is_null: true
      columns:
        - amount
        - approved_by
        - booker_single_use
        - code
        - created_by
        - description
        - enabled
        - id
        - levels
        - type
        - uses_max
        - valid_from
        - valid_to
      backend_only: false
select_permissions:
  - role: finance
    permission:
      columns:
        - id
        - code
        - description
        - type
        - amount
        - valid_from
        - valid_to
        - booker_single_use
        - uses_max
        - levels
        - enabled
        - approved_by
        - created_by
        - created_at
        - updated_at
        - denied_by
      filter: {}
      allow_aggregations: true
  - role: sales-admin
    permission:
      columns:
        - id
        - code
        - description
        - type
        - amount
        - valid_from
        - valid_to
        - booker_single_use
        - uses_max
        - levels
        - enabled
        - approved_by
        - created_by
        - created_at
        - updated_at
        - denied_by
      filter: {}
      allow_aggregations: true
  - role: tt-ops
    permission:
      columns:
        - amount
        - approved_by
        - booker_single_use
        - code
        - created_at
        - created_by
        - denied_by
        - description
        - enabled
        - id
        - levels
        - type
        - updated_at
        - uses_max
        - valid_from
        - valid_to
      filter: {}
      allow_aggregations: true
update_permissions:
  - role: finance
    permission:
      columns:
        - amount
        - approved_by
        - booker_single_use
        - code
        - created_by
        - denied_by
        - description
        - enabled
        - levels
        - type
        - uses_max
        - valid_from
        - valid_to
      filter: {}
      check: {}
  - role: ld
    permission:
      columns: []
      filter: {}
      check: null
  - role: sales-admin
    permission:
      columns:
        - amount
        - approved_by
        - booker_single_use
        - code
        - created_by
        - denied_by
        - description
        - enabled
        - levels
        - type
        - uses_max
        - valid_from
        - valid_to
      filter: {}
      check: {}
  - role: tt-ops
    permission:
      columns:
        - amount
        - approved_by
        - booker_single_use
        - code
        - created_by
        - denied_by
        - description
        - enabled
        - levels
        - type
        - uses_max
        - valid_from
        - valid_to
      filter: {}
      check: {}
delete_permissions:
  - role: finance
    permission:
      filter: {}
  - role: sales-admin
    permission:
      filter: {}
  - role: tt-ops
    permission:
      filter: {}
event_triggers:
  - name: promo_code_created
    definition:
      enable_manual: false
      insert:
        columns: '*'
      update:
        columns:
          - amount
    retry_conf:
      num_retries: 0
      interval_sec: 10
      timeout_sec: 60
    webhook: '{{EVENTS_HOST}}/promocode/created'
