table:
  schema: public
  name: course_participant
configuration:
  custom_root_fields: {}
  column_config:
    booking_date:
      custom_name: bookingDate
    go1_enrolment_status:
      custom_name: go1EnrolmentStatus
    go1_enrolment_id:
      custom_name: go1EnrolmentId
    date_graded:
      custom_name: dateGraded
    hs_consent:
      custom_name: healthSafetyConsent
    invoice_id:
      custom_name: invoiceID
  custom_column_names:
    booking_date: bookingDate
    go1_enrolment_status: go1EnrolmentStatus
    go1_enrolment_id: go1EnrolmentId
    date_graded: dateGraded
    hs_consent: healthSafetyConsent
    invoice_id: invoiceID
object_relationships:
  - name: certificate
    using:
      manual_configuration:
        remote_table:
          schema: public
          name: course_certificate
        insertion_order: null
        column_mapping:
          certificate_id: id
  - name: course
    using:
      foreign_key_constraint_on: course_id
  - name: invite
    using:
      foreign_key_constraint_on: invite_id
  - name: profile
    using:
      foreign_key_constraint_on: profile_id
array_relationships:
  - name: certificateChanges
    using:
      foreign_key_constraint_on:
        column: participant_id
        table:
          schema: public
          name: course_certificate_changelog
  - name: gradingModules
    using:
      foreign_key_constraint_on:
        column: course_participant_id
        table:
          schema: public
          name: course_participant_module
insert_permissions:
  - role: user
    permission:
      check:
        invite:
          email:
            _eq: X-Hasura-User-Email
      set:
        profile_id: x-hasura-User-Id
      columns:
        - course_id
        - invite_id
      backend_only: false
select_permissions:
  - role: anonymous
    permission:
      columns:
        - course_id
        - id
      filter:
        course:
          _and:
            - course_type:
                _eq: OPEN
            - course_status:
                _eq: SCHEDULED
      allow_aggregations: true
  - role: trainer
    permission:
      columns:
        - attended
        - hs_consent
        - course_id
        - go1_enrolment_id
        - go1_enrolment_status
        - grade
        - grading_feedback
        - booking_date
        - created_at
        - date_graded
        - updated_at
        - certificate_id
        - id
        - invite_id
        - invoice_id
        - profile_id
        - registration_id
      filter:
        course:
          trainers:
            profile_id:
              _eq: X-Hasura-User-Id
      allow_aggregations: true
  - role: tt-ops
    permission:
      columns:
        - attended
        - booking_date
        - certificate_id
        - course_id
        - created_at
        - date_graded
        - go1_enrolment_id
        - go1_enrolment_status
        - grade
        - grading_feedback
        - hs_consent
        - id
        - invite_id
        - invoice_id
        - profile_id
        - registration_id
        - updated_at
      filter: {}
      allow_aggregations: true
  - role: unverified
    permission:
      columns:
        - id
      filter:
        course:
          course_type:
            _eq: OPEN
      allow_aggregations: true
  - role: user
    permission:
      columns:
        - attended
        - booking_date
        - certificate_id
        - course_id
        - date_graded
        - go1_enrolment_status
        - grade
        - grading_feedback
        - hs_consent
        - id
        - invoice_id
        - profile_id
        - registration_id
      filter:
        _or:
          - profile:
              organizations:
                organization:
                  members:
                    profile_id:
                      _eq: X-Hasura-User-Id
          - profile_id:
              _eq: X-Hasura-User-Id
      allow_aggregations: true
update_permissions:
  - role: trainer
    permission:
      columns:
        - attended
        - date_graded
        - grade
        - grading_feedback
        - hs_consent
      filter:
        course:
          trainers:
            profile_id:
              _eq: X-Hasura-User-Id
      check: {}
  - role: tt-admin
    permission:
      columns:
        - id
        - registration_id
        - invoice_id
        - booking_date
        - profile_id
        - invite_id
        - go1_enrolment_id
        - attended
        - go1_enrolment_status
        - created_at
        - updated_at
        - grading_feedback
        - grade
        - date_graded
        - course_id
        - certificate_id
        - hs_consent
      filter: {}
      check: null
  - role: tt-ops
    permission:
      columns:
        - grade
        - updated_at
      filter: {}
      check: null
delete_permissions:
  - role: tt-admin
    permission:
      filter: {}
event_triggers:
  - name: course_participant_graded
    definition:
      enable_manual: true
      insert:
        columns: '*'
      update:
        columns:
          - grade
    retry_conf:
      num_retries: 0
      interval_sec: 10
      timeout_sec: 60
    webhook: '{{EVENTS_HOST}}/course/status'
  - name: create_certificate
    definition:
      enable_manual: true
      update:
        columns:
          - grade
    retry_conf:
      num_retries: 0
      interval_sec: 10
      timeout_sec: 60
    webhook: '{{EVENTS_HOST}}/certificate/insert'
  - name: go1_link
    definition:
      enable_manual: false
      insert:
        columns: '*'
    retry_conf:
      num_retries: 3
      interval_sec: 10
      timeout_sec: 10
    webhook: '{{EVENTS_HOST}}/go1/link'
  - name: issue_go1_license
    definition:
      enable_manual: true
      insert:
        columns: '*'
    retry_conf:
      num_retries: 0
      interval_sec: 10
      timeout_sec: 60
    webhook: '{{EVENTS_HOST}}/go1-licensing/issue-license'
