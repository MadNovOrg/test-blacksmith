table:
  schema: public
  name: course
configuration:
  custom_root_fields: {}
  column_config:
    free_spaces:
      custom_name: freeSpaces
    cancellation_reason:
      custom_name: cancellationReason
    cancellation_fee_percent:
      custom_name: cancellationFeePercent
    aol_cost_of_course:
      custom_name: aolCostOfCourse
    course_type:
      custom_name: type
    aol_region:
      custom_name: aolRegion
    aol_country:
      custom_name: aolCountry
    modules_duration:
      custom_name: modulesDuration
    course_status:
      custom_name: status
    sales_representative_id:
      custom_name: salesRepresentativeId
    created_by_id:
      custom_name: createdById
    grading_started:
      custom_name: gradingStarted
    grading_confirmed:
      custom_name: gradingConfirmed
    course_level:
      custom_name: level
    updated_at:
      custom_name: updatedAt
    created_at:
      custom_name: createdAt
    go1_integration:
      custom_name: go1Integration
    account_code:
      custom_name: accountCode
    contact_profile_id:
      custom_name: contactProfileId
    course_delivery_type:
      custom_name: deliveryType
  custom_column_names:
    free_spaces: freeSpaces
    cancellation_reason: cancellationReason
    cancellation_fee_percent: cancellationFeePercent
    aol_cost_of_course: aolCostOfCourse
    course_type: type
    aol_region: aolRegion
    aol_country: aolCountry
    modules_duration: modulesDuration
    course_status: status
    sales_representative_id: salesRepresentativeId
    created_by_id: createdById
    grading_started: gradingStarted
    grading_confirmed: gradingConfirmed
    course_level: level
    updated_at: updatedAt
    created_at: createdAt
    go1_integration: go1Integration
    account_code: accountCode
    contact_profile_id: contactProfileId
    course_delivery_type: deliveryType
object_relationships:
  - name: cancellationRequest
    using:
      foreign_key_constraint_on:
        column: course_id
        table:
          schema: public
          name: course_cancellation_request
  - name: contactProfile
    using:
      foreign_key_constraint_on: contact_profile_id
  - name: createdBy
    using:
      foreign_key_constraint_on: created_by_id
  - name: organization
    using:
      foreign_key_constraint_on: organization_id
  - name: salesRepresentative
    using:
      foreign_key_constraint_on: sales_representative_id
array_relationships:
  - name: evaluation_answers
    using:
      foreign_key_constraint_on:
        column: course_id
        table:
          schema: public
          name: course_evaluation_answers
  - name: expenses
    using:
      foreign_key_constraint_on:
        column: course_id
        table:
          schema: public
          name: course_expenses
  - name: modules
    using:
      foreign_key_constraint_on:
        column: course_id
        table:
          schema: public
          name: course_module
  - name: orders
    using:
      foreign_key_constraint_on:
        column: course_id
        table:
          schema: public
          name: order
  - name: participants
    using:
      foreign_key_constraint_on:
        column: course_id
        table:
          schema: public
          name: course_participant
  - name: promo_codes
    using:
      foreign_key_constraint_on:
        column: course_id
        table:
          schema: public
          name: course_promo_code
  - name: schedule
    using:
      foreign_key_constraint_on:
        column: course_id
        table:
          schema: public
          name: course_schedule
  - name: trainers
    using:
      foreign_key_constraint_on:
        column: course_id
        table:
          schema: public
          name: course_trainer
  - name: waitlists
    using:
      foreign_key_constraint_on:
        column: course_id
        table:
          schema: public
          name: waitlist
computed_fields:
  - name: course_code
    definition:
      function:
        schema: public
        name: course_code
  - name: end
    definition:
      function:
        schema: public
        name: course_end_date
  - name: start
    definition:
      function:
        schema: public
        name: course_start_date
insert_permissions:
  - role: sales-admin
    permission:
      check:
        course_type:
          _eq: CLOSED
      set:
        created_by_id: x-hasura-User-Id
      columns:
        - account_code
        - aol_cost_of_course
        - aol_country
        - aol_region
        - cancellation_fee_percent
        - cancellation_reason
        - contact_profile_id
        - course_delivery_type
        - course_level
        - course_status
        - course_type
        - created_at
        - description
        - free_spaces
        - go1_integration
        - grading_confirmed
        - grading_started
        - id
        - max_participants
        - min_participants
        - modules_duration
        - name
        - notes
        - organization_id
        - reaccreditation
        - sales_representative_id
        - updated_at
      backend_only: false
  - role: trainer
    permission:
      check: {}
      set:
        created_by_id: x-hasura-User-Id
      columns:
        - aol_cost_of_course
        - aol_country
        - aol_region
        - contact_profile_id
        - course_delivery_type
        - course_level
        - course_status
        - course_type
        - created_at
        - description
        - free_spaces
        - go1_integration
        - grading_confirmed
        - id
        - max_participants
        - min_participants
        - modules_duration
        - name
        - notes
        - organization_id
        - reaccreditation
        - updated_at
      backend_only: false
  - role: tt-ops
    permission:
      check: {}
      set:
        created_by_id: x-hasura-User-Id
      columns:
        - account_code
        - aol_cost_of_course
        - aol_country
        - aol_region
        - contact_profile_id
        - course_delivery_type
        - course_level
        - course_status
        - course_type
        - created_at
        - description
        - free_spaces
        - go1_integration
        - grading_confirmed
        - id
        - max_participants
        - min_participants
        - modules_duration
        - name
        - notes
        - organization_id
        - reaccreditation
        - sales_representative_id
        - updated_at
      backend_only: false
select_permissions:
  - role: anonymous
    permission:
      columns:
        - course_delivery_type
        - course_level
        - course_status
        - course_type
        - created_at
        - description
        - id
        - max_participants
        - min_participants
        - name
        - reaccreditation
        - updated_at
      computed_fields:
        - course_code
        - end
        - start
      filter:
        _and:
          - course_type:
              _eq: OPEN
          - course_status:
              _in:
                - CONFIRM_MODULES
                - SCHEDULED
                - TRAINER_MISSING
                - TRAINER_PENDING
                - TRAINER_UNAVAILABLE
  - role: sales-admin
    permission:
      columns:
        - account_code
        - aol_cost_of_course
        - aol_country
        - aol_region
        - cancellation_fee_percent
        - cancellation_reason
        - contact_profile_id
        - course_delivery_type
        - course_level
        - course_status
        - course_type
        - created_at
        - created_by_id
        - description
        - free_spaces
        - go1_integration
        - grading_confirmed
        - grading_started
        - id
        - max_participants
        - min_participants
        - modules_duration
        - name
        - notes
        - organization_id
        - reaccreditation
        - sales_representative_id
        - updated_at
      computed_fields:
        - course_code
        - end
        - start
      filter:
        course_type:
          _eq: CLOSED
      allow_aggregations: true
  - role: trainer
    permission:
      columns:
        - account_code
        - aol_cost_of_course
        - aol_country
        - aol_region
        - contact_profile_id
        - course_delivery_type
        - course_level
        - course_status
        - course_type
        - created_at
        - created_by_id
        - description
        - free_spaces
        - go1_integration
        - grading_confirmed
        - grading_started
        - id
        - max_participants
        - min_participants
        - modules_duration
        - name
        - notes
        - organization_id
        - reaccreditation
        - sales_representative_id
        - updated_at
      computed_fields:
        - course_code
        - end
        - start
      filter:
        _or:
          - trainers:
              profile_id:
                _eq: X-Hasura-User-Id
          - _and:
              - course_type:
                  _eq: OPEN
              - participants:
                  profile:
                    organizations:
                      organization:
                        members:
                          _and:
                            - is_admin:
                                _eq: true
                            - profile_id:
                                _eq: X-Hasura-User-Id
          - organization:
              members:
                _and:
                  - profile_id:
                      _eq: X-Hasura-User-Id
                  - is_admin:
                      _eq: true
          - _and:
              - course_type:
                  _eq: OPEN
              - course_status:
                  _in:
                    - CONFIRM_MODULES
                    - SCHEDULED
                    - TRAINER_MISSING
                    - TRAINER_PENDING
                    - TRAINER_UNAVAILABLE
      allow_aggregations: true
  - role: tt-ops
    permission:
      columns:
        - account_code
        - aol_cost_of_course
        - aol_country
        - aol_region
        - cancellation_fee_percent
        - cancellation_reason
        - contact_profile_id
        - course_delivery_type
        - course_level
        - course_status
        - course_type
        - created_at
        - description
        - free_spaces
        - go1_integration
        - grading_confirmed
        - grading_started
        - id
        - max_participants
        - min_participants
        - modules_duration
        - name
        - notes
        - organization_id
        - reaccreditation
        - sales_representative_id
        - updated_at
      computed_fields:
        - course_code
        - end
        - start
      filter: {}
      allow_aggregations: true
  - role: unverified
    permission:
      columns:
        - aol_cost_of_course
        - aol_country
        - aol_region
        - contact_profile_id
        - course_delivery_type
        - course_level
        - course_status
        - course_type
        - created_at
        - description
        - free_spaces
        - go1_integration
        - grading_confirmed
        - grading_started
        - id
        - max_participants
        - min_participants
        - name
        - organization_id
        - reaccreditation
        - updated_at
      computed_fields:
        - course_code
        - end
        - start
      filter:
        _and:
          - course_type:
              _eq: OPEN
          - course_status:
              _in:
                - CONFIRM_MODULES
                - SCHEDULED
                - TRAINER_MISSING
                - TRAINER_PENDING
                - TRAINER_UNAVAILABLE
  - role: user
    permission:
      columns:
        - account_code
        - aol_cost_of_course
        - aol_country
        - aol_region
        - contact_profile_id
        - course_delivery_type
        - course_level
        - course_status
        - course_type
        - created_at
        - created_at
        - description
        - free_spaces
        - go1_integration
        - grading_confirmed
        - grading_started
        - id
        - max_participants
        - min_participants
        - modules_duration
        - name
        - notes
        - organization_id
        - reaccreditation
        - sales_representative_id
        - updated_at
      computed_fields:
        - course_code
        - end
        - start
      filter:
        _or:
          - participants:
              profile_id:
                _eq: X-Hasura-User-Id
          - _and:
              - course_type:
                  _eq: OPEN
              - participants:
                  profile:
                    organizations:
                      organization:
                        members:
                          _and:
                            - is_admin:
                                _eq: true
                            - profile_id:
                                _eq: X-Hasura-User-Id
          - organization:
              members:
                _and:
                  - is_admin:
                      _eq: true
                  - profile_id:
                      _eq: X-Hasura-User-Id
          - _and:
              - course_type:
                  _eq: OPEN
              - course_status:
                  _in:
                    - CONFIRM_MODULES
                    - SCHEDULED
                    - TRAINER_MISSING
                    - TRAINER_PENDING
                    - TRAINER_UNAVAILABLE
      allow_aggregations: true
update_permissions:
  - role: sales-admin
    permission:
      columns:
        - account_code
        - aol_cost_of_course
        - aol_country
        - aol_region
        - cancellation_fee_percent
        - cancellation_reason
        - contact_profile_id
        - course_delivery_type
        - course_level
        - course_status
        - course_type
        - created_at
        - description
        - free_spaces
        - go1_integration
        - grading_confirmed
        - grading_started
        - id
        - max_participants
        - min_participants
        - modules_duration
        - name
        - notes
        - organization_id
        - reaccreditation
        - sales_representative_id
        - updated_at
      filter:
        course_type:
          _eq: CLOSED
      check: null
  - role: trainer
    permission:
      columns:
        - aol_cost_of_course
        - aol_country
        - aol_region
        - cancellation_reason
        - contact_profile_id
        - course_delivery_type
        - course_level
        - course_status
        - created_at
        - description
        - free_spaces
        - go1_integration
        - grading_confirmed
        - grading_started
        - id
        - max_participants
        - min_participants
        - modules_duration
        - name
        - notes
        - organization_id
        - reaccreditation
        - updated_at
      filter:
        _or:
          - trainers:
              profile_id:
                _eq: X-Hasura-User-Id
          - organization:
              members:
                _and:
                  - profile_id:
                      _eq: X-Hasura-User-Id
                  - is_admin:
                      _eq: true
      check: null
  - role: tt-ops
    permission:
      columns:
        - account_code
        - aol_cost_of_course
        - aol_country
        - aol_region
        - cancellation_fee_percent
        - cancellation_reason
        - contact_profile_id
        - course_delivery_type
        - course_level
        - course_status
        - course_type
        - created_at
        - description
        - free_spaces
        - go1_integration
        - grading_confirmed
        - grading_started
        - id
        - max_participants
        - min_participants
        - modules_duration
        - name
        - notes
        - organization_id
        - reaccreditation
        - sales_representative_id
        - updated_at
      filter: {}
      check: {}
  - role: user
    permission:
      columns:
        - course_status
        - grading_confirmed
        - grading_started
      filter:
        trainers:
          profile_id:
            _eq: X-Hasura-User-Id
      check: null
delete_permissions:
  - role: tt-ops
    permission:
      filter: {}
event_triggers:
  - name: cancel_licenses
    definition:
      enable_manual: true
      update:
        columns: '*'
    retry_conf:
      num_retries: 0
      interval_sec: 10
      timeout_sec: 60
    webhook: '{{EVENTS_HOST}}/go1-licensing/cancel-licenses'
  - name: course_created
    definition:
      enable_manual: false
      insert:
        columns: '*'
    retry_conf:
      num_retries: 0
      interval_sec: 10
      timeout_sec: 60
    webhook: '{{EVENTS_HOST}}/email/course-created'
  - name: course_status_changed
    definition:
      enable_manual: false
      update:
        columns:
          - id
          - course_status
          - course_type
    retry_conf:
      num_retries: 0
      interval_sec: 10
      timeout_sec: 60
    webhook: '{{EVENTS_HOST}}/email/course-status-changed'
  - name: course_status_recalculation
    definition:
      enable_manual: false
      update:
        columns:
          - course_status
    retry_conf:
      num_retries: 0
      interval_sec: 10
      timeout_sec: 60
    webhook: '{{EVENTS_HOST}}/course/status/clear'
  - name: release_licenses
    definition:
      enable_manual: true
      update:
        columns:
          - course_status
    retry_conf:
      num_retries: 0
      interval_sec: 10
      timeout_sec: 60
    webhook: '{{EVENTS_HOST}}/go1-licensing/release-licenses'
  - name: reserve_go1_licenses
    definition:
      enable_manual: true
      insert:
        columns: '*'
    retry_conf:
      num_retries: 0
      interval_sec: 10
      timeout_sec: 60
    webhook: '{{EVENTS_HOST}}/go1-licensing/reserve-licenses'
